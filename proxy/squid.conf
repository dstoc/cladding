http_port 8080
visible_hostname proxy-pod

# Startup injects this from container /etc/resolv.conf.
dns_nameservers REPLACE_DNS_IP

acl cli_src src "/tmp/cli_ips.lst"
acl sandbox_src src "/tmp/sandbox_ips.lst"
acl cli_domains dstdomain "/opt/proxy/cli_domains.lst"
acl sandbox_domains dstdomain "/opt/proxy/sandbox_domains.lst"

acl cli_sandbox_host dstdomain sandbox-pod
acl cli_sandbox_port port 3000

acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl CONNECT method CONNECT

http_access allow cli_src cli_sandbox_host cli_sandbox_port
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow cli_src cli_domains
http_access allow sandbox_src sandbox_domains
http_access deny all

cache deny all
cache_log stdio:/dev/stderr
access_log stdio:/dev/stdout

pid_filename /tmp/squid.pid
coredump_dir /tmp
